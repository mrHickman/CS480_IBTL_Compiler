from parseTree import ParseTree
from operationType import OperationType

class TypeChecker:
    def __init__(self, parseTree):
        self.ParseTree = parseTree
        self.currentNode = ''
#         self.nodeStack = []
#         self.nodeStack.append(self.ParseTree.getNextLeftMostNode())
        self.childCountStack = []
        self.typeStack = []
        self.getNextNode()
        self.checkType()
        
    def checkType(self):
        while not currentNode.getParent() :
            while self.isTypeTerminal() || : # or done
                self.getNextNode()
            #the last node will all ways be the root node
            #add break condition

                
    def isTypeTerminal(self):
        tempType = self.typeStack[-1]  
        if tempType == 'bool' or tempType == 'int' or  tempType == 'float' or tempType == 'string' or tempType == 'name':
            return True
        else :
            return False
        
    def getNextNode(self):
        self.currentNode = self.ParseTree.getNextLeftMostNode()
        self.childCountStack.append(self.currentNode.getChildCount())
        self.typeStack.append(self.currentNode.getToken().getType())
        
    def getScopeNode(self):
        currentScopeNode = self.currentNode
        parentNode = currentScopeNode.getParent()
        while parentNode != self.ParseTree.getRoot() :
            currentScopeNode = parentNode
            parentNode = currentScopeNode.getParent()
        return currentScopeNode
    
    def convertScopeToFloat(self):
        tempTree = ParseTree(self.getScopeNode())
        currentNode = tempTree.getNextLeftMostNode()
        while currentNode != tempTree.getRoot():
            if currentNode.getToken().getType() == 'int':
                tempTree.injectType('float')            
            currentNode = tempTree.getNextLeftMostNode()
        
        for x in range (0, len(self.typeStack)) :
            if self.typeStack[x] == 'int':
                self.typeStack[x]  = 'float'
